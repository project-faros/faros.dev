

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Cluster Configuration &mdash; Faros  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  
    <link rel="canonical" href="faros.dev/configuration.html" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Cluster Deployment" href="deploy.html" />
    <link rel="prev" title="Faros Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #19647E" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo_name_white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Cluster Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Faros Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cluster Configuration</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#hardware-configuration">Hardware configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#network-initial-condition">Network initial condition</a></li>
<li class="toctree-l2"><a class="reference internal" href="#openshift-cluster-configuration">OpenShift cluster configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#router-configuration">Router Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Cluster Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#host-record-configuration">Host Record Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bastion-node-guest">Bastion Node Guest</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extra-dns-dhcp-records">Extra DNS/DHCP Records</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#network-proxy-configuration">Network Proxy Configuration</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#proxy-configuration">Proxy Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Cluster Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Cluster Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvidia.html">NVIDIA Support</a></li>
<li class="toctree-l1"><a class="reference internal" href="operate.html">Day 2 Cluster Operation</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Verified Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="farosctl.html">farosctl Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">repos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">devenv</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">ansiblefacts</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">deploys</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/projects/1">Roadmap</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/issues">Bug Report</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros">GitHub</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Faros</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Cluster Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <!-- User defined GitHub URL -->
              <a href="https://github.com/project-faros/faros.dev/blob/master/source/configuration.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="cluster-configuration">
<h1>Cluster Configuration<a class="headerlink" href="#cluster-configuration" title="Permalink to this headline">¶</a></h1>
<p>Before begining the cluster deployement, it is necessary to confirm the
hardware and network setup. Then, the cluster configuration options can be set.</p>
<section id="hardware-configuration">
<h2>Hardware configuration<a class="headerlink" href="#hardware-configuration" title="Permalink to this headline">¶</a></h2>
<p>A few settings on the hardware of the cluster node firmware must be properly
configured for the installation to work.</p>
<ol class="arabic">
<li><p>Both UEFI and Legacy/BIOS booting are supported, however, the boot order of
each node must be the following:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>OS hard drive</p></li>
<li><p>IPv4 PXE using the cluster connected NIC</p></li>
<li><p>Everything else</p></li>
</ol>
</div></blockquote>
</li>
<li><p>For the out of band management, each node must use the same username
and password for control.</p></li>
<li><p>The out of band management interface must be configured to use DHCP when
joining the network.</p></li>
<li><p>All drives in the nodes should be blank before begining the installation.
There should not be an operating system installed on any drive of the
cluster nodes as this can cause issues booting CoreOS, particularly in UEFI
mode.</p></li>
<li><p>The hardware system clock must be properly set.</p></li>
<li><p>Repeat for each node.</p></li>
</ol>
<p>These settings can be configured before starting the deployment or during. If
you require access to the cluster nodes’ out-of-band management interfaces to
perform this configuration then wait until during the deployment. The
deployment will pause once the out-of-band management interfaces have an IP
Address.</p>
</section>
<section id="network-initial-condition">
<h2>Network initial condition<a class="headerlink" href="#network-initial-condition" title="Permalink to this headline">¶</a></h2>
<p>Before starting the cluster deployement, it is required that each node is
connected to the layer 2 switch that will be used by the cluster. It is highly
recomended to leave the out-of-band management NICs disconnected when starting
the deployment. During the deployment process, you will be instructed when to
connect them.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is highly recomended to leave the out of band management interfaces
disconnected when begining cluster deployement.</p>
<p>It is possible to leave the management interfaces connected during the
entire install process, but there may be a delay waiting for them to get
properly addressed.</p>
</div>
</section>
<section id="openshift-cluster-configuration">
<h2>OpenShift cluster configuration<a class="headerlink" href="#openshift-cluster-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Faros CLI provides a TUI to make configuring the cluster easy. To launch
the configuration interface, run the following command as the administrative
user:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">farosctl</span> <span class="n">config</span>
</pre></div>
</div>
<section id="router-configuration">
<h3>Router Configuration<a class="headerlink" href="#router-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following options are available:</p>
<dl>
<dt>LAN Interfaces</dt><dd><p>Select which NICs on the bastion node should be put onto the cluster’s
internal network.
Selecting more than one NIC allows connecting more devices to the
cluster network. For example, you may select a 10gbe NIC and a 1gbe NIC to
be on the cluster network so that you can attach a 1gbe switch and a 10gbe
switch to the network.</p>
</dd>
<dt>Subnet</dt><dd><p>The subnet IP definition that should be used for cluster nodes. When using
the gateway in PAT mode, this decision is far less impactful.</p>
</dd>
<dt>Subnet Mask</dt><dd><p>The CIDR prefix for the subnet.</p>
</dd>
<dt>Premitted Ingress Traffic</dt><dd><p>These options control the firewall configuration. They control what traffic
is allowed into the cluster. The following modes are available and can be
toggled on/off individually</p>
<blockquote>
<div><ul class="simple">
<li><p><em>SSH to Bastion</em> - Allow external nodes to SSH to the bastion</p></li>
<li><p><em>HTTPS to Cluster API</em> - Allow external nodes to contact the OpenShift
API</p></li>
<li><p><em>HTTP to Cluster Apps</em> - Allow external nodes to contact applications
running in the OpenShift cluster via HTTP</p></li>
<li><p><em>HTTPS to Cluster Apps</em> - Allow external nodes to contact applications
running in the OpenShift cluster via HTTPS</p></li>
<li><p><em>HTTPS to Cockpit Panel</em> - Allow external nodes to connect to the
Cockpit control plane running on port 9090 on the bastion via HTTPS</p></li>
<li><p><em>External to Internal Routing - DANGER</em> - This configures the gateway
in router mode as opposed to port forwarding mode. USE WITH CAUTION.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>Upstream DNS Forwarders</dt><dd><p>By default, the cluster’s DNS server will use 1.1.1.1 to forward out of
zone DNS requests. This option may be used to set alternate servers for
these purposes.</p>
</dd>
</dl>
</section>
<section id="id1">
<h3>Cluster Configuration<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The following options are available:</p>
<dl class="simple">
<dt>Administrator Password</dt><dd><p>The password required for the administrator user on the bastion node. This
is used to allow the installer to use sudo.</p>
</dd>
<dt>Pull Secret</dt><dd><p>Your pull secret from <a class="reference external" href="https://cloud.redhat.com/openshift/install/pull-secret">cloud.redhat.com</a></p>
</dd>
<dt>FIPS Mode:</dt><dd><p>This option indictes if FIPS mode should be enabled on the cluster.</p>
</dd>
</dl>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Enabling FIPS mode on the cluster <strong>WILL NOT</strong> configure FIPS on the bastion
node. FIPS on the bastion node should be enabled at install time. Enabling
FIPS on the cluster may break the functionality of some applications.</p>
</div>
</section>
<section id="host-record-configuration">
<h3>Host Record Configuration<a class="headerlink" href="#host-record-configuration" title="Permalink to this headline">¶</a></h3>
<p>The following options are available:</p>
<dl>
<dt>Machine Management Provider</dt><dd><p>The protocol used to talk to the hosts’ out-of-bandmanagement interface.
Currently only iLo can be used.</p>
</dd>
<dt>Machine Management User</dt><dd><p>The username that should be used when accessing the out-of-band management
interfaces.</p>
</dd>
<dt>Machine Management Password</dt><dd><p>The password that should be used when accessing the out-of-band management
interfaces.</p>
</dd>
<dt>Control Plane Machines</dt><dd><p>This interface allows configuration of each of the bare metal machines that
will be used to create the OpenShift control plane. Each node requires
three values:</p>
<blockquote>
<div><ul>
<li><p><em>Node Name</em>: The hostname that will be given to the node. Note: This is
not the FQDN, just the hostname.</p></li>
<li><p><em>Network Interface</em>: <em>[OPTIONAL]</em> The NIC on the node that should be
configured on the cluster network.</p>
<blockquote>
<div><ul class="simple">
<li><p>If this is left blank, the network interface will be be configured by DHCP on every boot. A static IP assignement will be made on the DHCP server.</p></li>
<li><p>If a single NIC is configured (ex: eno5), after the first boot, the NIC will be configured to manually set the node’s IP address without using DHCP.</p></li>
<li><p>A network bond can be configured here using the sytax <cite>NIC0,NIC1:MODE</cite> (ex: eno4,eno4:balance-xor). In this situation, the IP address will be statically assigned and the bond will be configured. The node must still be able to boot using a single NIC in order to PXE boot. Configuring the backing network switching architecture to support bonding is out of scope of the installer. For the bonding mode, balance-rr, active-backup, balance-xor, broadcast, and 802.3ad are the only supported options.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><em>MAC Address</em>: The MAC address for the node’s cluster connected NIC. In
the case of a bond, this should be the MAC address of the first NIC in
the bond. The first NIC in the bond must be able to come up
independantly without the second NIC for PXE booting.</p></li>
<li><p><em>Management IP</em>: This field is only required if the <em>Management MAC
Address</em> is not provided. Using this field to specify on IP address for
the out of band management interface allows those interfaces to be on
a network seperate from the cluster network. This is better for static
installs as it increases availability, but decreases portability.</p></li>
<li><p><em>Management MAC Address</em>: This field is only required if the
<em>Management IP</em> is not provided. Using this field to specify the MAC
address of the out of band management interface allows the installer to
provision an address for the management interface on the cluster
network. This reduces the availability of the management interfaces as
the bastion node will need to be on and reachable to interact with the
management interfaces. However, it greatly increases portability of the
installed cluster as no additional networks are required.</p></li>
<li><p><em>OS Install Drive</em>: This drive in the node onto which CoreOS will be
installed. Address the drive by name only. Eg: sda</p></li>
</ul>
</div></blockquote>
</dd>
<dt>Container Cache Disk</dt><dd><p><em>[OPTIONAL]</em> Configuring this setting will move the container cache
directories on the host (/var/lib/kubelet and /var/lib/containers) to a
secondary disk. This greatly improves the performance on three node
clusters. This is less important if an NVME is used for the OS drive. The
container cache disk <strong>MUST BE</strong> at least 100 GB. Address the drive by name
only. Eg: sdb</p>
</dd>
</dl>
</section>
<section id="bastion-node-guest">
<h3>Bastion Node Guest<a class="headerlink" href="#bastion-node-guest" title="Permalink to this headline">¶</a></h3>
<p>The following options configure a virtual cluster node on the bastion.</p>
<dl class="simple">
<dt>Create app node VM on bastion</dt><dd><p>A switch to enable or disable the bastion node guest VM configuration.</p>
</dd>
<dt>Node name</dt><dd><p>The hostname to assign to the VM.</p>
</dd>
<dt>Core Count</dt><dd><p>The number of cores that should be mapped to the virtual machine.</p>
</dd>
<dt>Memory (GB)</dt><dd><p>The amount of RAM that should be allocated to the virtual machine.</p>
</dd>
<dt>Host devices to passthrough</dt><dd><p>Use this option to select PCI devices that are available to be mapped to
guest virtual machine. For a PCI device to be listed here, it must be
configured to use the <code class="code docutils literal notranslate"><span class="pre">pci-stub</span></code> Kernel driver. This process is documented
in detail <cite>here
&lt;https://faros.dev/https://faros.dev/installation.html#prepare-pci-passthrough-devices&gt;</cite>.</p>
</dd>
<dt>Host drives to passthrough</dt><dd><p>Drives that are not currently mounted anywhere on the bastion will be
listed here. Select them to mount them into the guest node as SCSI devices.</p>
</dd>
</dl>
</section>
<section id="extra-dns-dhcp-records">
<h3>Extra DNS/DHCP Records<a class="headerlink" href="#extra-dns-dhcp-records" title="Permalink to this headline">¶</a></h3>
<p>These options allow for additional configuration of the DNS and DHCP services
beyond the minimum required for a cluster deployment. They exist, mostly, for
convenience.</p>
<dl>
<dt>Static IP Reservations</dt><dd><p>Any additional static records that should be configured in the DNS and DHCP
servers. For example, WiFi access points, chassis management interfaces,
bastion node out-of-band management, and any additional custom servers.
Each extra record requires the following information:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Node Name</em>: The hostname that will be given to the node. Note: This is
not the FQDN, just the hostname.</p></li>
<li><p><em>MAC Address</em>: The MAC address for the node’s cluster connected NIC</p></li>
<li><p><em>Requested IP Address</em>: The IP address that is desired for the record.
The request will be ignored if the IP address has already been asigned
on the network. This can be left blank to have an available static IP
address automatically assigned.</p></li>
</ul>
</div></blockquote>
</dd>
<dt>DHCP Ignored MAC Addresses</dt><dd><p>If there are any interfaces on the cluster layer 2 network that you do not
want to be able to dynamically obtain an IP address, you must configure
them here. The entries here will be ignored when making DHCP requests.
Note: This does not provide the security of forcing them off the network.
It only precents them from obtaining the network details dynamically. These
records require the following information:</p>
<blockquote>
<div><ul class="simple">
<li><p><em>Entry Name</em>: A unique name for the record to make it recognizable</p></li>
<li><p><em>MAC Address</em>: The MAC address for the node’s cluster connected NIC</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</section>
</section>
<section id="network-proxy-configuration">
<h2>Network Proxy Configuration<a class="headerlink" href="#network-proxy-configuration" title="Permalink to this headline">¶</a></h2>
<p>If a network proxy must be used in order to access the internet for
installation, a seperate config TUI is available to provide the proxy settings.
When the proxy settings are configured, they will be used on the bastion node
to pull sources as well as configured on the OpenShift cluster.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>farosctl config proxy
</pre></div>
</div>
<section id="proxy-configuration">
<h3>Proxy Configuration<a class="headerlink" href="#proxy-configuration" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>Setup Cluster Proxy</dt><dd><p>A boolean setting to control if the proxy settings should be deployed.</p>
</dd>
<dt>HTTP Proxy</dt><dd><p>The URL to the HTTP proxy in the format <code class="code docutils literal notranslate"><span class="pre">PROTOCOL://USER:PASS&#64;FQDN:PORT</span></code></p>
</dd>
<dt>HTTPS Proxy</dt><dd><p>The URL to the HTTPS proxy in the format <code class="code docutils literal notranslate"><span class="pre">PROTOCOL://USER:PASS&#64;FQDN:PORT</span></code></p>
</dd>
<dt>No Proxy Destinations</dt><dd><p>The IP spaces and domains that should not be filtered through the proxy.</p>
</dd>
<dt>Additional CA Bundle</dt><dd><p>If the proxy inspects HTTPS traffic, its CA Bundle must be uploaded to the
cluster during install so that HTTPS traffic will still be trusted. These
public certs should be pasted here.</p>
</dd>
</dl>
<p>Faros stores stateful configurations made above in <cite>~/.config/faros/default</cite> for
reference or backup.</p>
</section>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="deploy.html" class="btn btn-neutral float-right" title="Cluster Deployment" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="installation.html" class="btn btn-neutral float-left" title="Faros Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Project Faros Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>