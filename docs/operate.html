

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Day 2 Cluster Operation &mdash; Faros  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  
    <link rel="canonical" href="faros.dev/operate.html" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Verified Implementation" href="example.html" />
    <link rel="prev" title="NVIDIA Support" href="nvidia.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #19647E" >
          

          
            <a href="index.html">
          

          
            
            <img src="_static/logo_name_white.svg" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Cluster Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Faros Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Cluster Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="deploy.html">Cluster Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="storage.html">Cluster Persistent Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="nvidia.html">NVIDIA Support</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Day 2 Cluster Operation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#start-up-and-shutdown-procedures">Start up and shutdown procedures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#updating-the-cluster">Updating the cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#patch-the-cluster">Patch the cluster</a></li>
<li class="toctree-l3"><a class="reference internal" href="#patch-the-bastion-node">Patch the bastion node</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#configure-user-accounts">Configure user accounts</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-cluster-https-certs">Configure cluster HTTPS certs</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-nodes-to-the-cluster">Add nodes to the cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#destroying-the-cluster">Destroying the cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="example.html">Verified Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="farosctl.html">farosctl Usage</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributing</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">repos</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">devenv</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">ansiblefacts</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">deploys</a></li>
<li class="toctree-l1"><a class="reference external" href="https://faros.dev">docs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/projects/1">Roadmap</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros/cluster-manager/issues">Bug Report</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/project-faros">GitHub</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Faros</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          



















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Day 2 Cluster Operation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <!-- User defined GitHub URL -->
              <a href="https://github.com/project-faros/faros.dev/blob/master/source/operate.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="day-2-cluster-operation">
<h1>Day 2 Cluster Operation<a class="headerlink" href="#day-2-cluster-operation" title="Permalink to this headline">¶</a></h1>
<section id="start-up-and-shutdown-procedures">
<h2>Start up and shutdown procedures<a class="headerlink" href="#start-up-and-shutdown-procedures" title="Permalink to this headline">¶</a></h2>
<p>The Faros tooling includes scripts for automated cluster shutdown and startup:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Safely stop and bring down the cluster</span>
farosctl shutdown
<span class="c1"># Shutdown the bastion node</span>
poweroff

<span class="c1"># Bring the cluster up and wait for it to be healthy</span>
farosctl startup
</pre></div>
</div>
</section>
<section id="updating-the-cluster">
<h2>Updating the cluster<a class="headerlink" href="#updating-the-cluster" title="Permalink to this headline">¶</a></h2>
<section id="patch-the-cluster">
<h3>Patch the cluster<a class="headerlink" href="#patch-the-cluster" title="Permalink to this headline">¶</a></h3>
<p>The OpenShift cluster may be patched by following the standard procedures. It
is recomened to use the GUI for patching. The official Red Hat documentation
containers detailed <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/updating/updating-cluster.html">OpenShift updating instructions</a>.</p>
</section>
<section id="patch-the-bastion-node">
<h3>Patch the bastion node<a class="headerlink" href="#patch-the-bastion-node" title="Permalink to this headline">¶</a></h3>
<p>To patch the bastion node, simply:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>dnf -y update
reboot
</pre></div>
</div>
<p>Please note, there will be a cluster disruption while the bastion node is
patched. Cluster services will continue to run, but they will be unavailable.</p>
</section>
</section>
<section id="configure-user-accounts">
<h2>Configure user accounts<a class="headerlink" href="#configure-user-accounts" title="Permalink to this headline">¶</a></h2>
<p>There are many options for configuring user accounts in OpenShift. Two common
methods are <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/identity_providers/configuring-ldap-identity-provider.html">using LDAP authentication</a>
or <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/identity_providers/configuring-htpasswd-identity-provider.html">using an HTPasswd file</a>.</p>
</section>
<section id="configure-cluster-https-certs">
<h2>Configure cluster HTTPS certs<a class="headerlink" href="#configure-cluster-https-certs" title="Permalink to this headline">¶</a></h2>
<p>Not strictly necessary, but often desireable, official documentation is
available on how to <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/certificates/replacing-default-ingress-certificate.html">update the application HTTPS certificate</a>
and on how to <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/authentication/certificates/api-server.html">update the API HTTPS certificate</a>.</p>
</section>
<section id="add-nodes-to-the-cluster">
<h2>Add nodes to the cluster<a class="headerlink" href="#add-nodes-to-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>To add additional application nodes to the cluster, the DHCP and DNS zones on
the bastion must be manually updated to add records for that host and configure
them to PXE boot to the CoreOS installer with the worker ignition file.
Detailed instructions are available for <a class="reference external" href="https://docs.openshift.com/container-platform/4.4/installing/installing_bare_metal/installing-bare-metal.html#installation-user-infra-machines-pxe_installing-bare-metal">creating RHCOS machines with PXE
booting</a>.</p>
</section>
<section id="destroying-the-cluster">
<h2>Destroying the cluster<a class="headerlink" href="#destroying-the-cluster" title="Permalink to this headline">¶</a></h2>
<p>The installed cluster can be destroyed to safely prepare for another install.
The following commands perform this procedure.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Destroy the OpenShift cluster and wipe all hard drives in cluster nodes.</span>
farosctl destroy cluster

<span class="c1"># Clear all installation sources including CoreOS images and configurations</span>
farosctl destroy install-repos

<span class="c1"># Remove the Load Balancer that fronts the cluster</span>
farosctl destroy load-balancer
</pre></div>
</div>
<p>Alternatively, all of these processes can be triggered in succession.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>farosctl destroy
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>While ALL disks on ALL cluster nodes will be wiped as part of this process,
they are NOT securely wiped. Only the partition tables and volume
definitions are erased. To easily ensure the data on these drives can never
be accessed again, either securely wipe them using a third party tool or
erase the Tang server’s keys at /var/db/tang on the bastion server.</p>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="example.html" class="btn btn-neutral float-right" title="Verified Implementation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="nvidia.html" class="btn btn-neutral float-left" title="NVIDIA Support" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Project Faros Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>